<form>
  <label>Cognito Detect Detections</label>
  <fieldset autoRun="true" submitButton="false">
    <input type="time" searchWhenChanged="true" token="timepicker">
      <label>Timerange:</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" searchWhenChanged="true" token="category_token">
      <label>Detection Categories:</label>
      <choice value="*">All</choice>
      <default>*</default>
      <search>
        <query>`vectra_index` sourcetype="vectra:cognito:detect" signature!="hsc" signature!="audit" signature!=campaigns signature!="health" | stats count by category</query>
        <earliest>-30d@d</earliest>
        <latest>now</latest>
      </search>
      <fieldForLabel>category</fieldForLabel>
      <fieldForValue>category</fieldForValue>
      <prefix>"</prefix>
      <suffix>"</suffix>
    </input>
    <input type="dropdown" token="signature_name_token" searchWhenChanged="true">
      <label>Type</label>
      <choice value="*">All</choice>
      <default>*</default>
      <search>
        <query>`vectra_index` sourcetype="vectra:cognito:detect" signature!="hsc" signature!="audit" signature!=campaigns signature!="health" category=$category_token$ | stats count by signature_name</query>
        <earliest>-30d@d</earliest>
        <latest>now</latest>
      </search>
      <fieldForLabel>signature_name</fieldForLabel>
      <fieldForValue>signature_name</fieldForValue>
      <prefix>"</prefix>
      <suffix>"</suffix>
    </input>
    <input type="text" searchWhenChanged="true" token="search_token">
      <label>Search Filter:</label>
      <default>*</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Detection Type Activity over Time</title>
      <chart>
        <search>
          <query>`vectra_index` sourcetype="vectra:cognito:detect" signature!="hsc" signature!="audit" signature!=campaigns signature!="health" $search_token$ category=$category_token$ signature_name=$signature_name_token$ |dedup external_id| timechart count by category</query>
          <earliest>$timepicker.earliest$</earliest>
          <latest>$timepicker.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisLabelsY.majorUnit">1</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">1</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Detection Type Table</title>
      <table>
        <search>
          <query>`vectra_index` sourcetype="vectra:cognito:detect" signature!="hsc" signature!="audit" signature!=campaigns signature!="health" $search_token$ category=$category_token$ signature_name=$signature_name_token$ external_id=* |dedup external_id | eval category=case (category=="COMMAND &amp; CONTROL", "Command &amp; Control", category== "BOTNET ACTIVITY","Botnet Activity", category=="RECONNAISSANCE","Reconnaissance",category=="LATERAL MOVEMENT","Lateral_Movement",category=="EXFILTRATION","Exfiltration") | convert timeformat="%Y-%m-%dT%H:%M:%S%z" ctime(_time) | table triaged, category, signature_name, src, src_ip, dest, dest_ip, threat, certainty, vectra_url ,_time | rename triaged AS Triaged category AS Category signature_name AS Type src AS "Source" src_ip AS "Source IP" threat AS Threat certainty AS Certainty vectra_url AS "Detection Details" _time AS "Latest Detection" dest AS "Destination" dest_ip AS "Destination IP" event_id AS "Event ID"</query>
          <earliest>$timepicker.earliest$</earliest>
          <latest>$timepicker.latest$</latest>
        </search>
        <option name="count">25</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">true</option>
        <drilldown target="My New Window">
          <condition field="Category">
            <set token="form.cat">$click.value2$</set>
          </condition>
          <condition field="Type">
            <set token="form.cat">*</set>
            <set token="form.name">$click.value2$</set>
          </condition>
          <condition field="Source">
            <link>
              <![CDATA[detections?form.search=$click.value2$&form.form.hostname=$click.value2$&form.time.earliest=$time.earliest$&form.time.latest=$time.latest$]]>
            </link>
          </condition>
          <condition field="Src IP">
            <link>
              <![CDATA[detections?form.search=$click.value2$&form.time.earliest=$time.earliest$&form.time.latest=$time.latest$]]>
            </link>
          </condition>
          <condition field="Dst IP">
            <link>
              <![CDATA[detections?form.search=$click.value2$&form.time.earliest=$time.earliest$&form.time.latest=$time.latest$]]>
            </link>
          </condition>
          <condition field="Detection Details">
            <link>$click.value2|n$</link>
          </condition>
          <condition field="Threat"></condition>
          <condition field="Certainty"></condition>
          <condition field="Latest Detection"></condition>
        </drilldown>
      </table>
    </panel>
  </row>
</form>